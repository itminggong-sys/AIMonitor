import{j as e,H as s}from"./index-BqT3aLp1.js";import{r}from"./vendor-CZIWcOcD.js";import{G as i,B as t,a4 as l,W as a,X as n,H as d,a as c,a1 as o,f as h,a5 as x,I as m,U as j,a6 as u,a7 as g,S as p,b as y,a8 as v,c as f,h as b,e as k,i as w}from"./antd-B8UvalbT.js";const{Option:C}=j,{TextArea:I}=m,{TabPane:S}=c,N=()=>{const[N,z]=r.useState("rules"),[A,_]=r.useState(!1),[U,P]=r.useState(null),[T]=i.useForm(),W=[{id:"1",name:"CPU使用率过高",metric:"cpu_usage",condition:">",threshold:80,severity:"critical",enabled:!0,description:"当CPU使用率超过80%时触发告警",createdAt:"2024-01-15 10:30:00",lastTriggered:"2024-01-20 14:25:00"},{id:"2",name:"内存使用率告警",metric:"memory_usage",condition:">",threshold:85,severity:"high",enabled:!0,description:"当内存使用率超过85%时触发告警",createdAt:"2024-01-15 10:35:00",lastTriggered:"2024-01-20 16:10:00"},{id:"3",name:"磁盘空间不足",metric:"disk_usage",condition:">",threshold:90,severity:"high",enabled:!0,description:"当磁盘使用率超过90%时触发告警",createdAt:"2024-01-15 10:40:00"},{id:"4",name:"服务响应时间过长",metric:"response_time",condition:">",threshold:5e3,severity:"medium",enabled:!1,description:"当服务响应时间超过5秒时触发告警",createdAt:"2024-01-15 11:00:00"}],F=[{id:"1",ruleName:"CPU使用率过高",message:"服务器 web-01 CPU使用率达到95%",severity:"critical",status:"active",source:"web-01",triggeredAt:"2024-01-20 14:25:00"},{id:"2",ruleName:"内存使用率告警",message:"服务器 database-01 内存使用率达到92%",severity:"high",status:"acknowledged",source:"database-01",triggeredAt:"2024-01-20 16:10:00"},{id:"3",ruleName:"磁盘空间不足",message:"服务器 storage-01 磁盘使用率达到95%",severity:"high",status:"resolved",source:"storage-01",triggeredAt:"2024-01-20 12:30:00",resolvedAt:"2024-01-20 13:45:00",duration:"1小时15分钟"},{id:"4",ruleName:"CPU使用率过高",message:"服务器 web-02 CPU使用率达到88%",severity:"critical",status:"resolved",source:"web-02",triggeredAt:"2024-01-20 10:15:00",resolvedAt:"2024-01-20 10:45:00",duration:"30分钟"}],q=[{title:"规则名称",dataIndex:"name",key:"name",render:(s,r)=>e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:500},children:s}),e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:r.description})]})},{title:"监控指标",dataIndex:"metric",key:"metric",render:e=>({cpu_usage:"CPU使用率",memory_usage:"内存使用率",disk_usage:"磁盘使用率",response_time:"响应时间"}[e]||e)},{title:"条件",key:"condition",render:s=>e.jsxs("span",{children:[s.condition," ",s.threshold,"response_time"===s.metric?"ms":"%"]})},{title:"严重程度",dataIndex:"severity",key:"severity",render:s=>e.jsx(y,{color:{critical:"red",high:"orange",medium:"blue",low:"green"}[s],children:s.toUpperCase()})},{title:"状态",dataIndex:"enabled",key:"enabled",render:s=>e.jsx(y,{color:s?"green":"default",children:s?"启用":"禁用"})},{title:"最后触发",dataIndex:"lastTriggered",key:"lastTriggered",render:e=>e||"从未触发"},{title:"操作",key:"actions",render:s=>e.jsxs(p,{children:[e.jsx(t,{type:"text",icon:e.jsx(v,{}),onClick:()=>H(s),children:"编辑"}),e.jsx(t,{type:"text",icon:e.jsx(f,{}),danger:!0,onClick:()=>J(s.id),children:"删除"})]})}],K=[{title:"告警信息",key:"alert",render:s=>e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:500},children:s.message}),e.jsxs("div",{style:{fontSize:"12px",color:"#666"},children:["规则: ",s.ruleName]})]})},{title:"严重程度",dataIndex:"severity",key:"severity",render:s=>e.jsx(y,{color:{critical:"red",high:"orange",medium:"blue",low:"green"}[s],children:s.toUpperCase()})},{title:"状态",dataIndex:"status",key:"status",render:s=>{const r={active:{color:"red",icon:e.jsx(w,{}),text:"活跃"},acknowledged:{color:"orange",icon:e.jsx(k,{}),text:"已确认"},resolved:{color:"green",icon:e.jsx(b,{}),text:"已解决"}},{color:i,icon:t,text:l}=r[s];return e.jsx(y,{color:i,icon:t,children:l})}},{title:"来源",dataIndex:"source",key:"source"},{title:"触发时间",dataIndex:"triggeredAt",key:"triggeredAt"},{title:"持续时间",dataIndex:"duration",key:"duration",render:e=>e||"-"},{title:"操作",key:"actions",render:s=>e.jsxs(p,{children:["active"===s.status&&e.jsx(t,{size:"small",type:"primary",children:"确认"}),e.jsx(t,{size:"small",children:"详情"})]})}],H=e=>{P(e),T.setFieldsValue(e),_(!0)},J=e=>{x.confirm({title:"确认删除",content:"确定要删除这个告警规则吗？",onOk:()=>{console.log("删除规则:",e)}})},O=()=>F.filter(e=>"active"===e.status).length;return e.jsxs(e.Fragment,{children:[e.jsxs(s,{children:[e.jsx("title",{children:"告警管理 - AI Monitor System"}),e.jsx("meta",{name:"description",content:"告警规则配置和告警历史管理"})]}),e.jsxs("div",{className:"fade-in",children:[e.jsxs("div",{className:"flex-between mb-24",children:[e.jsxs("div",{children:[e.jsx("h1",{style:{margin:0,fontSize:"24px",fontWeight:600},children:"告警管理"}),e.jsx("p",{style:{margin:"8px 0 0 0",color:"#666"},children:"配置告警规则和查看告警历史"})]}),e.jsx(t,{type:"primary",icon:e.jsx(l,{}),onClick:()=>{P(null),T.resetFields(),_(!0)},children:"新增规则"})]}),e.jsxs(a,{gutter:[16,16],className:"mb-24",children:[e.jsx(n,{xs:24,sm:6,children:e.jsxs(d,{className:"card-shadow text-center",children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:600,color:"#1890ff"},children:W.length}),e.jsx("div",{style:{color:"#666"},children:"告警规则"})]})}),e.jsx(n,{xs:24,sm:6,children:e.jsxs(d,{className:"card-shadow text-center",children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:600,color:"#52c41a"},children:W.filter(e=>e.enabled).length}),e.jsx("div",{style:{color:"#666"},children:"启用规则"})]})}),e.jsx(n,{xs:24,sm:6,children:e.jsxs(d,{className:"card-shadow text-center",children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:600,color:"#ff4d4f"},children:O()}),e.jsx("div",{style:{color:"#666"},children:"活跃告警"})]})}),e.jsx(n,{xs:24,sm:6,children:e.jsxs(d,{className:"card-shadow text-center",children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:600,color:"#faad14"},children:F.filter(e=>"acknowledged"===e.status).length}),e.jsx("div",{style:{color:"#666"},children:"待处理"})]})})]}),e.jsxs(c,{activeKey:N,onChange:z,children:[e.jsx(S,{tab:"告警规则",children:e.jsx(d,{className:"card-shadow",children:e.jsx(o,{dataSource:W,columns:q,rowKey:"id",pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条规则`}})})},"rules"),e.jsx(S,{tab:e.jsx(h,{count:O(),size:"small",children:e.jsx("span",{children:"告警历史"})}),children:e.jsx(d,{className:"card-shadow",children:e.jsx(o,{dataSource:F,columns:K,rowKey:"id",pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条告警`}})})},"history")]}),e.jsx(x,{title:U?"编辑告警规则":"新增告警规则",open:A,onCancel:()=>_(!1),footer:null,width:600,children:e.jsxs(i,{form:T,layout:"vertical",onFinish:async e=>{try{console.log("保存规则:",e),_(!1),T.resetFields()}catch(s){console.error("保存失败:",s)}},children:[e.jsx(i.Item,{name:"name",label:"规则名称",rules:[{required:!0,message:"请输入规则名称"}],children:e.jsx(m,{placeholder:"请输入规则名称"})}),e.jsxs(a,{gutter:16,children:[e.jsx(n,{span:12,children:e.jsx(i.Item,{name:"metric",label:"监控指标",rules:[{required:!0,message:"请选择监控指标"}],children:e.jsxs(j,{placeholder:"请选择监控指标",children:[e.jsx(C,{value:"cpu_usage",children:"CPU使用率"}),e.jsx(C,{value:"memory_usage",children:"内存使用率"}),e.jsx(C,{value:"disk_usage",children:"磁盘使用率"}),e.jsx(C,{value:"response_time",children:"响应时间"})]})})}),e.jsx(n,{span:6,children:e.jsx(i.Item,{name:"condition",label:"条件",rules:[{required:!0,message:"请选择条件"}],children:e.jsxs(j,{placeholder:"条件",children:[e.jsx(C,{value:">",children:"大于"}),e.jsx(C,{value:"<",children:"小于"}),e.jsx(C,{value:">=",children:"大于等于"}),e.jsx(C,{value:"<=",children:"小于等于"}),e.jsx(C,{value:"==",children:"等于"})]})})}),e.jsx(n,{span:6,children:e.jsx(i.Item,{name:"threshold",label:"阈值",rules:[{required:!0,message:"请输入阈值"}],children:e.jsx(u,{placeholder:"阈值",style:{width:"100%"},min:0})})})]}),e.jsxs(a,{gutter:16,children:[e.jsx(n,{span:12,children:e.jsx(i.Item,{name:"severity",label:"严重程度",rules:[{required:!0,message:"请选择严重程度"}],children:e.jsxs(j,{placeholder:"请选择严重程度",children:[e.jsx(C,{value:"critical",children:"严重"}),e.jsx(C,{value:"high",children:"高"}),e.jsx(C,{value:"medium",children:"中"}),e.jsx(C,{value:"low",children:"低"})]})})}),e.jsx(n,{span:12,children:e.jsx(i.Item,{name:"enabled",label:"启用状态",valuePropName:"checked",children:e.jsx(g,{checkedChildren:"启用",unCheckedChildren:"禁用"})})})]}),e.jsx(i.Item,{name:"description",label:"描述",children:e.jsx(I,{placeholder:"请输入规则描述",rows:3})}),e.jsx(i.Item,{className:"mb-0",children:e.jsxs(p,{className:"w-full flex-end",children:[e.jsx(t,{onClick:()=>_(!1),children:"取消"}),e.jsx(t,{type:"primary",htmlType:"submit",children:U?"更新":"创建"})]})})]})})]})]})};export{N as default};
