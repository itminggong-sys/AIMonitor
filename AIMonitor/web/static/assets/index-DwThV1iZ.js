import{j as e,H as l}from"./index-DIu9wXaB.js";import{r as a}from"./vendor-D6r2_tUy.js";import{H as s,B as r,a8 as i,Z as t,_ as n,J as d,a as c,a3 as o,f as u,a4 as h,K as v,X as m,ab as b,ac as x,S as p,b as _,a9 as g,c as j,h as y,e as k,i as f}from"./antd-C8aMnYDz.js";const{Option:w}=m,{TextArea:C}=v,P=({form:l})=>{const a=s.useWatch("metricCategory",l),r=s.useWatch("monitorTarget",l);return e.jsx(m,{placeholder:a?r?"请选择监控指标":"请先选择监控目标":"请先选择监控类型",disabled:!a||!r,children:(()=>{if(!a)return[];switch(a){case"system":return r?r.includes("web")?[{value:"web_cpu_usage",label:"Web服务器CPU使用率"},{value:"web_memory_usage",label:"Web服务器内存使用率"},{value:"web_disk_usage",label:"Web服务器磁盘使用率"},{value:"web_network_io",label:"Web服务器网络IO"},{value:"web_connections",label:"Web服务器连接数"},{value:"web_response_time",label:"Web服务器响应时间"}]:r.includes("db")?[{value:"db_cpu_usage",label:"数据库服务器CPU使用率"},{value:"db_memory_usage",label:"数据库服务器内存使用率"},{value:"db_disk_usage",label:"数据库服务器磁盘使用率"},{value:"db_disk_io",label:"数据库服务器磁盘IO"},{value:"db_connections",label:"数据库连接数"},{value:"db_query_time",label:"数据库查询时间"}]:r.includes("cache")?[{value:"cache_cpu_usage",label:"缓存服务器CPU使用率"},{value:"cache_memory_usage",label:"缓存服务器内存使用率"},{value:"cache_disk_usage",label:"缓存服务器磁盘使用率"},{value:"cache_hit_rate",label:"缓存命中率"},{value:"cache_connections",label:"缓存连接数"},{value:"cache_evictions",label:"缓存淘汰数"}]:r.includes("app")?[{value:"app_cpu_usage",label:"应用服务器CPU使用率"},{value:"app_memory_usage",label:"应用服务器内存使用率"},{value:"app_disk_usage",label:"应用服务器磁盘使用率"},{value:"app_load_average",label:"应用服务器系统负载"},{value:"app_process_count",label:"应用进程数量"},{value:"app_thread_count",label:"应用线程数量"}]:[]:[];case"middleware":return r?r.includes("redis")?[{value:"redis_memory",label:"Redis内存使用率"},{value:"redis_connections",label:"Redis连接数"},{value:"redis_cpu",label:"Redis CPU使用率"},{value:"redis_hit_rate",label:"Redis缓存命中率"},{value:"redis_evicted_keys",label:"Redis淘汰键数"},{value:"redis_expired_keys",label:"Redis过期键数"}]:r.includes("mysql")?[{value:"mysql_connections",label:"MySQL连接数"},{value:"mysql_slow_queries",label:"MySQL慢查询数"},{value:"mysql_cpu",label:"MySQL CPU使用率"},{value:"mysql_memory",label:"MySQL内存使用率"},{value:"mysql_disk_io",label:"MySQL磁盘IO"},{value:"mysql_lock_waits",label:"MySQL锁等待时间"}]:r.includes("nginx")?[{value:"nginx_requests",label:"Nginx请求数"},{value:"nginx_response_time",label:"Nginx响应时间"},{value:"nginx_error_rate",label:"Nginx错误率"},{value:"nginx_connections",label:"Nginx活跃连接数"}]:r.includes("elasticsearch")?[{value:"elasticsearch_cpu",label:"Elasticsearch CPU使用率"},{value:"elasticsearch_memory",label:"Elasticsearch内存使用率"},{value:"elasticsearch_disk",label:"Elasticsearch磁盘使用率"},{value:"elasticsearch_query_time",label:"Elasticsearch查询时间"}]:r.includes("kafka")?[{value:"kafka_cpu",label:"Kafka CPU使用率"},{value:"kafka_memory",label:"Kafka内存使用率"},{value:"kafka_disk",label:"Kafka磁盘使用率"},{value:"kafka_message_rate",label:"Kafka消息速率"}]:r.includes("mongodb")?[{value:"mongodb_cpu",label:"MongoDB CPU使用率"},{value:"mongodb_memory",label:"MongoDB内存使用率"},{value:"mongodb_connections",label:"MongoDB连接数"},{value:"mongodb_query_time",label:"MongoDB查询时间"}]:r.includes("rabbitmq")?[{value:"rabbitmq_cpu",label:"RabbitMQ CPU使用率"},{value:"rabbitmq_memory",label:"RabbitMQ内存使用率"},{value:"rabbitmq_connections",label:"RabbitMQ连接数"},{value:"rabbitmq_queue_length",label:"RabbitMQ队列长度"}]:[]:[];case"apm":return r?r.includes("service")?[{value:"service_response_time",label:"服务响应时间"},{value:"service_error_rate",label:"服务错误率"},{value:"service_throughput",label:"服务吞吐量"},{value:"service_apdex_score",label:"服务Apdex评分"},{value:"service_cpu_usage",label:"服务CPU使用率"},{value:"service_memory_usage",label:"服务内存使用率"}]:r.includes("endpoint")?[{value:"endpoint_response_time",label:"接口响应时间"},{value:"endpoint_error_rate",label:"接口错误率"},{value:"endpoint_request_count",label:"接口请求数"},{value:"endpoint_success_rate",label:"接口成功率"},{value:"endpoint_database_time",label:"接口数据库时间"},{value:"endpoint_cache_hit_rate",label:"接口缓存命中率"}]:[]:[];case"container":return r?r.includes("pod")?[{value:"pod_cpu",label:"Pod CPU使用率"},{value:"pod_memory",label:"Pod内存使用率"},{value:"pod_restart_count",label:"Pod重启次数"},{value:"pod_status",label:"Pod状态"},{value:"container_count",label:"容器数量"},{value:"pod_network",label:"Pod网络流量"}]:r.includes("deployment")?[{value:"deployment_replicas",label:"Deployment副本数"},{value:"deployment_available",label:"可用副本数"},{value:"deployment_cpu",label:"Deployment CPU使用率"},{value:"deployment_memory",label:"Deployment内存使用率"},{value:"deployment_rollout",label:"部署状态"}]:r.includes("node")?[{value:"node_cpu",label:"节点CPU使用率"},{value:"node_memory",label:"节点内存使用率"},{value:"node_disk",label:"节点磁盘使用率"},{value:"node_network",label:"节点网络流量"},{value:"node_status",label:"节点状态"},{value:"node_pods",label:"节点Pod数量"}]:r.includes("namespace")?[{value:"namespace_cpu",label:"Namespace CPU使用率"},{value:"namespace_memory",label:"Namespace内存使用率"},{value:"namespace_pods",label:"Namespace Pod数量"},{value:"namespace_services",label:"Namespace服务数量"},{value:"namespace_quota",label:"资源配额使用率"}]:[]:[];case"virtualization":return r?r.includes("vm")?[{value:"vm_cpu_usage",label:"虚拟机CPU使用率"},{value:"vm_memory_usage",label:"虚拟机内存使用率"},{value:"vm_disk_usage",label:"虚拟机磁盘使用率"},{value:"vm_network_io",label:"虚拟机网络IO"},{value:"vm_disk_io",label:"虚拟机磁盘IO"},{value:"vm_power_state",label:"虚拟机电源状态"}]:r.includes("host")?[{value:"host_cpu_usage",label:"宿主机CPU使用率"},{value:"host_memory_usage",label:"宿主机内存使用率"},{value:"host_disk_usage",label:"宿主机磁盘使用率"},{value:"host_network_io",label:"宿主机网络IO"},{value:"host_vm_count",label:"宿主机虚拟机数量"},{value:"host_temperature",label:"宿主机温度"}]:r.includes("datastore")||r.includes("storage")?[{value:"storage_usage",label:"存储使用率"},{value:"storage_io_latency",label:"存储IO延迟"},{value:"storage_throughput",label:"存储吞吐量"},{value:"storage_iops",label:"存储IOPS"},{value:"storage_free_space",label:"存储可用空间"},{value:"storage_health",label:"存储健康状态"}]:[]:[];default:return[]}})().map(l=>e.jsx(w,{value:l.value,children:l.label},l.value))})},q=()=>{const[q,I]=a.useState("rules"),[N,S]=a.useState(!1),[U,M]=a.useState(null),[W]=s.useForm(),z=[{id:"1",name:"CPU使用率过高",metric:"cpu_usage",condition:">",threshold:80,severity:"critical",enabled:!0,description:"当CPU使用率超过80%时触发告警",createdAt:"2024-01-15 10:30:00",lastTriggered:"2024-01-20 14:25:00"},{id:"2",name:"内存使用率告警",metric:"memory_usage",condition:">",threshold:85,severity:"high",enabled:!0,description:"当内存使用率超过85%时触发告警",createdAt:"2024-01-15 10:35:00",lastTriggered:"2024-01-20 16:10:00"},{id:"3",name:"磁盘空间不足",metric:"disk_usage",condition:">",threshold:90,severity:"high",enabled:!0,description:"当磁盘使用率超过90%时触发告警",createdAt:"2024-01-15 10:40:00"},{id:"4",name:"服务响应时间过长",metric:"response_time",condition:">",threshold:5e3,severity:"medium",enabled:!1,description:"当服务响应时间超过5秒时触发告警",createdAt:"2024-01-15 11:00:00"}],A=[{id:"1",ruleName:"CPU使用率过高",message:"服务器 web-01 CPU使用率达到95%",severity:"critical",status:"active",source:"web-01",triggeredAt:"2024-01-20 14:25:00"},{id:"2",ruleName:"内存使用率告警",message:"服务器 database-01 内存使用率达到92%",severity:"high",status:"acknowledged",source:"database-01",triggeredAt:"2024-01-20 16:10:00"},{id:"3",ruleName:"磁盘空间不足",message:"服务器 storage-01 磁盘使用率达到95%",severity:"high",status:"resolved",source:"storage-01",triggeredAt:"2024-01-20 12:30:00",resolvedAt:"2024-01-20 13:45:00",duration:"1小时15分钟"},{id:"4",ruleName:"CPU使用率过高",message:"服务器 web-02 CPU使用率达到88%",severity:"critical",status:"resolved",source:"web-02",triggeredAt:"2024-01-20 10:15:00",resolvedAt:"2024-01-20 10:45:00",duration:"30分钟"}],Q=[{title:"规则名称",dataIndex:"name",key:"name",render:(l,a)=>e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:500},children:l}),e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:a.description})]})},{title:"监控指标",dataIndex:"metric",key:"metric",render:e=>({cpu_usage:"CPU使用率",memory_usage:"内存使用率",disk_usage:"磁盘使用率",response_time:"响应时间"}[e]||e)},{title:"条件",key:"condition",render:l=>e.jsxs("span",{children:[l.condition," ",l.threshold,"response_time"===l.metric?"ms":"%"]})},{title:"严重程度",dataIndex:"severity",key:"severity",render:l=>e.jsx(_,{color:{critical:"red",high:"orange",medium:"blue",low:"green"}[l],children:l.toUpperCase()})},{title:"状态",dataIndex:"enabled",key:"enabled",render:l=>e.jsx(_,{color:l?"green":"default",children:l?"启用":"禁用"})},{title:"最后触发",dataIndex:"lastTriggered",key:"lastTriggered",render:e=>e||"从未触发"},{title:"操作",key:"actions",render:l=>e.jsxs(p,{children:[e.jsx(r,{type:"text",icon:e.jsx(g,{}),onClick:()=>O(l),children:"编辑"}),e.jsx(r,{type:"text",icon:e.jsx(j,{}),danger:!0,onClick:()=>T(l.id),children:"删除"})]})}],R=[{title:"告警信息",key:"alert",render:l=>e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:500},children:l.message}),e.jsxs("div",{style:{fontSize:"12px",color:"#666"},children:["规则: ",l.ruleName]})]})},{title:"严重程度",dataIndex:"severity",key:"severity",render:l=>e.jsx(_,{color:{critical:"red",high:"orange",medium:"blue",low:"green"}[l],children:l.toUpperCase()})},{title:"状态",dataIndex:"status",key:"status",render:l=>{const a={active:{color:"red",icon:e.jsx(f,{}),text:"活跃"},acknowledged:{color:"orange",icon:e.jsx(k,{}),text:"已确认"},resolved:{color:"green",icon:e.jsx(y,{}),text:"已解决"}},{color:s,icon:r,text:i}=a[l];return e.jsx(_,{color:s,icon:r,children:i})}},{title:"来源",dataIndex:"source",key:"source"},{title:"触发时间",dataIndex:"triggeredAt",key:"triggeredAt"},{title:"持续时间",dataIndex:"duration",key:"duration",render:e=>e||"-"},{title:"操作",key:"actions",render:l=>e.jsxs(p,{children:["active"===l.status&&e.jsx(r,{size:"small",type:"primary",children:"确认"}),e.jsx(r,{size:"small",children:"详情"})]})}],O=e=>{M(e),W.setFieldsValue(e),S(!0)},T=e=>{h.confirm({title:"确认删除",content:"确定要删除这个告警规则吗？",onOk:()=>{console.log("删除规则:",e)}})},D=()=>A.filter(e=>"active"===e.status).length;return e.jsxs(e.Fragment,{children:[e.jsxs(l,{children:[e.jsx("title",{children:"告警管理 - AI Monitor System"}),e.jsx("meta",{name:"description",content:"告警规则配置和告警历史管理"})]}),e.jsxs("div",{className:"fade-in",children:[e.jsxs("div",{className:"flex-between mb-24",children:[e.jsxs("div",{children:[e.jsx("h1",{style:{margin:0,fontSize:"24px",fontWeight:600},children:"告警管理"}),e.jsx("p",{style:{margin:"8px 0 0 0",color:"#666"},children:"配置告警规则和查看告警历史"})]}),e.jsx(r,{type:"primary",icon:e.jsx(i,{}),onClick:()=>{M(null),W.resetFields(),S(!0)},children:"新增规则"})]}),e.jsxs(t,{gutter:[16,16],className:"mb-24",children:[e.jsx(n,{xs:24,sm:6,children:e.jsxs(d,{className:"card-shadow text-center",children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:600,color:"#1890ff"},children:z.length}),e.jsx("div",{style:{color:"#666"},children:"告警规则"})]})}),e.jsx(n,{xs:24,sm:6,children:e.jsxs(d,{className:"card-shadow text-center",children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:600,color:"#52c41a"},children:z.filter(e=>e.enabled).length}),e.jsx("div",{style:{color:"#666"},children:"启用规则"})]})}),e.jsx(n,{xs:24,sm:6,children:e.jsxs(d,{className:"card-shadow text-center",children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:600,color:"#ff4d4f"},children:D()}),e.jsx("div",{style:{color:"#666"},children:"活跃告警"})]})}),e.jsx(n,{xs:24,sm:6,children:e.jsxs(d,{className:"card-shadow text-center",children:[e.jsx("div",{style:{fontSize:"24px",fontWeight:600,color:"#faad14"},children:A.filter(e=>"acknowledged"===e.status).length}),e.jsx("div",{style:{color:"#666"},children:"待处理"})]})})]}),e.jsx(c,{activeKey:q,onChange:I,items:[{key:"rules",label:"告警规则",children:e.jsx(d,{className:"card-shadow",children:e.jsx(o,{dataSource:z,columns:Q,rowKey:"id",pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条规则`}})})},{key:"history",label:e.jsx(u,{count:D(),size:"small",children:e.jsx("span",{children:"告警历史"})}),children:e.jsx(d,{className:"card-shadow",children:e.jsx(o,{dataSource:A,columns:R,rowKey:"id",pagination:{pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条告警`}})})}]}),e.jsx(h,{title:U?"编辑告警规则":"新增告警规则",open:N,onCancel:()=>S(!1),footer:null,width:600,children:e.jsxs(s,{form:W,layout:"vertical",onFinish:async e=>{try{console.log("保存规则:",e),S(!1),W.resetFields()}catch(l){console.error("保存失败:",l)}},children:[e.jsx(s.Item,{name:"name",label:"规则名称",rules:[{required:!0,message:"请输入规则名称"}],children:e.jsx(v,{placeholder:"请输入规则名称"})}),e.jsxs(t,{gutter:16,children:[e.jsx(n,{span:8,children:e.jsx(s.Item,{name:"metricCategory",label:"监控类型",rules:[{required:!0,message:"请选择监控类型"}],children:e.jsxs(m,{placeholder:"请选择监控类型",onChange:e=>{W.setFieldsValue({monitorTarget:void 0,metric:void 0})},children:[e.jsx(w,{value:"system",children:"系统监控"}),e.jsx(w,{value:"middleware",children:"中间件监控"}),e.jsx(w,{value:"apm",children:"APM监控"}),e.jsx(w,{value:"container",children:"容器监控"}),e.jsx(w,{value:"virtualization",children:"虚拟化监控"})]})})}),e.jsx(n,{span:8,children:e.jsx(s.Item,{name:"monitorTarget",label:"监控目标",rules:[{required:!0,message:"请选择监控目标"}],children:e.jsx(m,{placeholder:s.useWatch("metricCategory",W)?"请选择监控目标":"请先选择监控类型",disabled:!s.useWatch("metricCategory",W),showSearch:!0,filterOption:(e,l)=>{var a;return null==(a=null==l?void 0:l.children)?void 0:a.toLowerCase().includes(e.toLowerCase())},onChange:()=>{W.setFieldsValue({metric:void 0})},children:(()=>{switch(s.useWatch("metricCategory",W)){case"system":return[e.jsx(w,{value:"server-web-01",children:"Web服务器: web-01"},"server-web-01"),e.jsx(w,{value:"server-db-01",children:"数据库服务器: db-01"},"server-db-01"),e.jsx(w,{value:"server-cache-01",children:"缓存服务器: cache-01"},"server-cache-01"),e.jsx(w,{value:"server-app-01",children:"应用服务器: app-01"},"server-app-01")];case"middleware":return[e.jsx(w,{value:"redis-standalone-01",children:"Redis实例: standalone-01"},"redis-standalone-01"),e.jsx(w,{value:"redis-cluster-01",children:"Redis集群: cluster-01"},"redis-cluster-01"),e.jsx(w,{value:"mysql-master-01",children:"MySQL主库: master-01"},"mysql-master-01"),e.jsx(w,{value:"mysql-slave-01",children:"MySQL从库: slave-01"},"mysql-slave-01"),e.jsx(w,{value:"nginx-lb-01",children:"Nginx负载均衡: lb-01"},"nginx-lb-01"),e.jsx(w,{value:"elasticsearch-cluster",children:"Elasticsearch集群"},"elasticsearch-cluster"),e.jsx(w,{value:"kafka-cluster",children:"Kafka集群"},"kafka-cluster"),e.jsx(w,{value:"mongodb-replica",children:"MongoDB副本集"},"mongodb-replica"),e.jsx(w,{value:"rabbitmq-cluster",children:"RabbitMQ集群"},"rabbitmq-cluster")];case"container":return[e.jsx(w,{value:"pod-frontend",children:"Pod: frontend"},"pod-frontend"),e.jsx(w,{value:"pod-backend",children:"Pod: backend"},"pod-backend"),e.jsx(w,{value:"pod-database",children:"Pod: database"},"pod-database"),e.jsx(w,{value:"deployment-frontend",children:"Deployment: frontend"},"deployment-frontend"),e.jsx(w,{value:"deployment-backend",children:"Deployment: backend"},"deployment-backend"),e.jsx(w,{value:"node-worker-01",children:"Node: worker-01"},"node-worker-01"),e.jsx(w,{value:"node-worker-02",children:"Node: worker-02"},"node-worker-02"),e.jsx(w,{value:"namespace-production",children:"Namespace: production"},"namespace-production")];case"apm":return[e.jsx(w,{value:"service-user-api",children:"服务: user-api"},"service-user-api"),e.jsx(w,{value:"service-order-api",children:"服务: order-api"},"service-order-api"),e.jsx(w,{value:"service-payment-api",children:"服务: payment-api"},"service-payment-api"),e.jsx(w,{value:"service-notification",children:"服务: notification"},"service-notification"),e.jsx(w,{value:"endpoint-login",children:"接口: /api/login"},"endpoint-login"),e.jsx(w,{value:"endpoint-checkout",children:"接口: /api/checkout"},"endpoint-checkout")];case"virtualization":return[e.jsx(w,{value:"vm-web-server-01",children:"虚拟机: web-server-01"},"vm-web-server-01"),e.jsx(w,{value:"vm-db-server-01",children:"虚拟机: db-server-01"},"vm-db-server-01"),e.jsx(w,{value:"host-esxi-01",children:"宿主机: esxi-01"},"host-esxi-01"),e.jsx(w,{value:"host-esxi-02",children:"宿主机: esxi-02"},"host-esxi-02"),e.jsx(w,{value:"datastore-storage-01",children:"存储: storage-01"},"datastore-storage-01")];default:return[]}})()})})}),e.jsx(n,{span:8,children:e.jsx(s.Item,{name:"metric",label:"监控指标",rules:[{required:!0,message:"请选择监控指标"}],children:e.jsx(P,{form:W})})})]}),e.jsxs(t,{gutter:16,children:[e.jsx(n,{span:8,children:e.jsx(s.Item,{name:"condition",label:"条件",rules:[{required:!0,message:"请选择条件"}],children:e.jsxs(m,{placeholder:"条件",children:[e.jsx(w,{value:">",children:"大于"}),e.jsx(w,{value:"<",children:"小于"}),e.jsx(w,{value:">=",children:"大于等于"}),e.jsx(w,{value:"<=",children:"小于等于"}),e.jsx(w,{value:"==",children:"等于"})]})})}),e.jsx(n,{span:8,children:e.jsx(s.Item,{name:"threshold",label:"阈值",rules:[{required:!0,message:"请输入阈值"}],children:e.jsx(b,{placeholder:"阈值",style:{width:"100%"},min:0})})}),e.jsx(n,{span:8,children:e.jsx(s.Item,{name:"unit",label:"单位",children:e.jsx(v,{placeholder:"如：%、MB、ms等"})})})]}),e.jsxs(t,{gutter:16,children:[e.jsx(n,{span:12,children:e.jsx(s.Item,{name:"severity",label:"严重程度",rules:[{required:!0,message:"请选择严重程度"}],children:e.jsxs(m,{placeholder:"请选择严重程度",children:[e.jsx(w,{value:"critical",children:"严重"}),e.jsx(w,{value:"high",children:"高"}),e.jsx(w,{value:"medium",children:"中"}),e.jsx(w,{value:"low",children:"低"})]})})}),e.jsx(n,{span:12,children:e.jsx(s.Item,{name:"enabled",label:"启用状态",valuePropName:"checked",children:e.jsx(x,{checkedChildren:"启用",unCheckedChildren:"禁用"})})})]}),e.jsx(s.Item,{name:"description",label:"描述",children:e.jsx(C,{placeholder:"请输入规则描述",rows:3})}),e.jsx(s.Item,{className:"mb-0",children:e.jsxs(p,{className:"w-full flex-end",children:[e.jsx(r,{onClick:()=>S(!1),children:"取消"}),e.jsx(r,{type:"primary",htmlType:"submit",children:U?"更新":"创建"})]})})]})})]})]})};export{q as default};
