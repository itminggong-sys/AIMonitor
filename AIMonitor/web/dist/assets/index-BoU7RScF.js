import{u as e,j as t}from"./index-BC7s2n7i.js";import{r as l}from"./vendor-D6r2_tUy.js";import{K as n,J as a,T as s,F as r,$ as i,a0 as o,N as c,a1 as d,ah as h,aa as g,z as u,y as x,O as y,Y as p,S as m,B as j,_ as v,Z as _,a5 as b,a6 as f,f as w,V as T,b as C,ak as k,ab as S,al as L,am as $,c as I}from"./antd-CJ5_bEWz.js";const{TextArea:Z}=y,{Option:z}=p,{Title:D,Text:F}=s,B=()=>{var s,B,P,U,H,R,q,O;const{isAuthenticated:A,user:E,token:M}=e();console.log("认证状态:",{isAuthenticated:A,user:E,token:M?"有token":"无token"});const{message:V}=n.useApp(),[J]=a.useForm(),[K]=a.useForm(),[N,Y]=l.useState(!1),[Q,G]=l.useState(null),[W,X]=l.useState([]),[ee,te]=l.useState(null),[le,ne]=l.useState(!1),[ae,se]=l.useState({page:1,page_size:10,category:"",search:""}),re=[{label:"故障诊断",value:"troubleshooting"},{label:"性能优化",value:"performance"},{label:"安全防护",value:"security"},{label:"运维经验",value:"operations"},{label:"最佳实践",value:"best_practices"},{label:"常见问题",value:"faq"}],ie=[{label:"低",value:"low",color:"green"},{label:"中",value:"medium",color:"orange"},{label:"高",value:"high",color:"red"},{label:"紧急",value:"critical",color:"purple"}],oe=[{id:"1",title:"CPU使用率过高问题排查指南",content:"当系统CPU使用率持续超过80%时，需要进行以下排查步骤：\n1. 使用top命令查看占用CPU最高的进程\n2. 检查是否有异常进程或死循环\n3. 分析应用程序性能瓶颈\n4. 考虑扩容或优化代码",category:"troubleshooting",tags:["CPU","性能","排查","监控"],metric_types:["cpu_usage","response_time"],severity:"high",created_by:"admin",created_at:"2024-01-15T10:30:00Z",updated_at:"2024-01-15T10:30:00Z"},{id:"2",title:"内存泄漏检测与处理方案",content:"内存泄漏是常见的性能问题，处理方法：\n1. 使用内存分析工具定位泄漏点\n2. 检查对象引用是否正确释放\n3. 优化缓存策略\n4. 定期重启服务作为临时方案",category:"performance",tags:["内存","泄漏","优化","JVM"],metric_types:["memory_usage","throughput"],severity:"critical",created_by:"admin",created_at:"2024-01-14T14:20:00Z",updated_at:"2024-01-14T14:20:00Z"},{id:"3",title:"数据库连接池配置最佳实践",content:"合理配置数据库连接池可以显著提升应用性能：\n1. 根据并发量设置合适的最大连接数\n2. 配置连接超时和空闲超时\n3. 启用连接验证\n4. 监控连接池使用情况",category:"best_practices",tags:["数据库","连接池","配置","性能"],metric_types:["response_time","throughput","availability"],severity:"medium",created_by:"admin",created_at:"2024-01-13T09:15:00Z",updated_at:"2024-01-13T09:15:00Z"},{id:"4",title:"网络延迟异常排查流程",content:"网络延迟问题排查步骤：\n1. 使用ping测试基本连通性\n2. 使用traceroute追踪路由路径\n3. 检查网络设备状态\n4. 分析网络流量是否异常\n5. 检查防火墙和安全组配置",category:"troubleshooting",tags:["网络","延迟","排查","连通性"],metric_types:["network_traffic","response_time"],severity:"high",created_by:"admin",created_at:"2024-01-12T16:45:00Z",updated_at:"2024-01-12T16:45:00Z"},{id:"5",title:"安全漏洞扫描与修复指南",content:"定期进行安全漏洞扫描是必要的安全措施：\n1. 使用自动化扫描工具\n2. 及时更新系统补丁\n3. 检查应用依赖库版本\n4. 配置安全策略\n5. 建立应急响应流程",category:"security",tags:["安全","漏洞","扫描","修复"],metric_types:["availability","error_rate"],severity:"critical",created_by:"admin",created_at:"2024-01-11T11:30:00Z",updated_at:"2024-01-11T11:30:00Z"},{id:"6",title:"磁盘空间不足处理方案",content:"磁盘空间不足的处理步骤：\n1. 清理临时文件和日志\n2. 压缩或删除旧的备份文件\n3. 移动数据到其他存储\n4. 扩容磁盘空间\n5. 设置磁盘使用率告警",category:"operations",tags:["磁盘","空间","清理","扩容"],metric_types:["disk_usage"],severity:"medium",created_by:"admin",created_at:"2024-01-10T13:20:00Z",updated_at:"2024-01-10T13:20:00Z"},{id:"7",title:"服务响应时间优化技巧",content:"提升服务响应时间的常用方法：\n1. 优化数据库查询\n2. 添加缓存层\n3. 使用CDN加速\n4. 代码性能优化\n5. 负载均衡配置",category:"performance",tags:["响应时间","优化","缓存","CDN"],metric_types:["response_time","throughput"],severity:"medium",created_by:"admin",created_at:"2024-01-09T08:10:00Z",updated_at:"2024-01-09T08:10:00Z"},{id:"8",title:"常见HTTP错误码处理方法",content:"常见HTTP错误码及处理方法：\n- 404: 检查URL路径和路由配置\n- 500: 查看服务器日志，检查代码错误\n- 502: 检查上游服务状态\n- 503: 服务不可用，检查服务状态\n- 504: 网关超时，检查服务响应时间",category:"faq",tags:["HTTP","错误码","故障","处理"],metric_types:["error_rate","availability"],severity:"low",created_by:"admin",created_at:"2024-01-08T15:40:00Z",updated_at:"2024-01-08T15:40:00Z"}],ce=oe.filter(e=>{const t=!ae.category||e.category===ae.category,l=!ae.search||e.title.toLowerCase().includes(ae.search.toLowerCase())||e.content.toLowerCase().includes(ae.search.toLowerCase())||e.tags.some(e=>e.toLowerCase().includes(ae.search.toLowerCase()))||e.created_by.toLowerCase().includes(ae.search.toLowerCase());return t&&l}),de=(ae.page-1)*ae.page_size,he=de+ae.page_size,ge={data:{items:ce.slice(de,he),total:ce.length,page:ae.page,page_size:ae.page_size}},ue={data:{knowledge_base_count:8,today_analysis_count:2,analysis_by_type:{troubleshooting:2,performance:2,security:1,operations:1,best_practices:1,faq:1}}},xe=()=>{console.log("刷新数据")},ye=e=>{G(e),J.setFieldsValue({title:e.title,content:e.content,category:e.category,tags:e.tags,metric_types:e.metric_types,severity:e.severity}),Y(!0)},pe=[{title:"标题",dataIndex:"title",key:"title",width:200,ellipsis:{showTitle:!1},render:(e,l)=>t.jsx(L,{placement:"topLeft",title:"点击查看详细内容",children:t.jsx(F,{strong:!0,style:{color:"#1890ff",cursor:"pointer",textDecoration:"underline"},onClick:()=>(te(l),void ne(!0)),children:e})})},{title:"分类",dataIndex:"category",key:"category",width:120,render:e=>{const l=re.find(t=>t.value===e);return t.jsx(C,{color:"blue",children:(null==l?void 0:l.label)||e})}},{title:"严重级别",dataIndex:"severity",key:"severity",width:100,render:e=>{const l=ie.find(t=>t.value===e);return t.jsx(w,{color:(null==l?void 0:l.color)||"default",text:(null==l?void 0:l.label)||e})}},{title:"标签",dataIndex:"tags",key:"tags",width:200,render:e=>t.jsxs(m,{wrap:!0,children:[null==e?void 0:e.slice(0,3).map(e=>t.jsx(C,{icon:t.jsx(k,{}),children:e},e)),(null==e?void 0:e.length)>3&&t.jsx(L,{title:e.slice(3).join(", "),children:t.jsxs(C,{children:["+",e.length-3]})})]})},{title:"指标类型",dataIndex:"metric_types",key:"metric_types",width:150,render:e=>t.jsxs(m,{wrap:!0,children:[null==e?void 0:e.slice(0,2).map(e=>t.jsx(C,{color:"green",children:e},e)),(null==e?void 0:e.length)>2&&t.jsx(L,{title:e.slice(2).join(", "),children:t.jsxs(C,{color:"green",children:["+",e.length-2]})})]})},{title:"创建时间",dataIndex:"created_at",key:"created_at",width:150,render:e=>new Date(e).toLocaleString()},{title:"操作",key:"action",width:120,fixed:"right",render:(e,l)=>t.jsxs(m,{children:[t.jsx(L,{title:"编辑",children:t.jsx(j,{type:"text",icon:t.jsx(S,{}),onClick:()=>ye(l)})}),t.jsx($,{title:"确定要删除这个知识库条目吗？",onConfirm:()=>(async e=>{try{await new Promise(e=>setTimeout(e,300)),console.log("模拟删除知识库条目:",e),V.success("删除成功"),xe()}catch(t){V.error("删除失败"),console.error("删除失败:",t)}})(l.id),okText:"确定",cancelText:"取消",children:t.jsx(L,{title:"删除",children:t.jsx(j,{type:"text",danger:!0,icon:t.jsx(I,{})})})})]})}];return t.jsxs("div",{style:{padding:"24px"},children:[t.jsxs("div",{style:{marginBottom:"24px"},children:[t.jsxs(D,{level:2,children:[t.jsx(r,{style:{marginRight:"8px"}}),"知识库管理"]}),t.jsx(F,{type:"secondary",children:"管理运维知识库，包括故障诊断、性能优化、最佳实践等经验总结"})]}),(null==ue?void 0:ue.data)&&t.jsxs(i,{gutter:16,style:{marginBottom:"24px"},children:[t.jsx(o,{xs:24,sm:12,md:6,children:t.jsx(c,{children:t.jsx(d,{title:"总条目数",value:ue.data.knowledge_base_count,prefix:t.jsx(h,{})})})}),t.jsx(o,{xs:24,sm:12,md:6,children:t.jsx(c,{children:t.jsx(d,{title:"今日新增",value:ue.data.today_analysis_count,prefix:t.jsx(g,{})})})}),t.jsx(o,{xs:24,sm:12,md:6,children:t.jsx(c,{children:t.jsx(d,{title:"故障诊断",value:null==(s=ue.data.analysis_by_type)?void 0:s.troubleshooting,prefix:t.jsx(u,{})})})}),t.jsx(o,{xs:24,sm:12,md:6,children:t.jsx(c,{children:t.jsx(d,{title:"性能优化",value:null==(B=ue.data.analysis_by_type)?void 0:B.performance,prefix:t.jsx(x,{})})})})]}),t.jsxs(c,{style:{marginBottom:"16px"},children:[t.jsxs(a,{form:K,layout:"inline",onFinish:e=>{se({...ae,page:1,category:e.category||"",search:e.search||""})},style:{marginBottom:"16px"},children:[t.jsx(a.Item,{name:"search",label:"搜索",children:t.jsx(y,{placeholder:"搜索标题或内容",allowClear:!0,style:{width:200}})}),t.jsx(a.Item,{name:"category",label:"分类",children:t.jsx(p,{placeholder:"选择分类",allowClear:!0,style:{width:150},children:re.map(e=>t.jsx(z,{value:e.value,children:e.label},e.value))})}),t.jsx(a.Item,{children:t.jsxs(m,{children:[t.jsx(j,{type:"primary",htmlType:"submit",icon:t.jsx(x,{}),children:"搜索"}),t.jsx(j,{onClick:()=>{K.resetFields(),se({page:1,page_size:10,category:"",search:""})},children:"重置"}),t.jsx(j,{icon:t.jsx(v,{}),onClick:xe,children:"刷新"})]})})]}),t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsx("div",{children:t.jsxs(m,{children:[t.jsxs(F,{type:"secondary",children:["共 ",(null==(P=null==ge?void 0:ge.data)?void 0:P.total)||0," 条记录"]}),W.length>0&&t.jsxs(F,{type:"secondary",children:["已选中 ",W.length," 条"]})]})}),t.jsxs(m,{children:[W.length>0&&t.jsx(j,{size:"small",onClick:()=>X([]),children:"清空选择"}),t.jsxs(j,{icon:t.jsx(_,{}),onClick:()=>{try{if(0===W.length)return void V.warning("请先选择要导出的知识库条目");const e=ce.filter(e=>W.includes(e.id));if(0===e.length)return void V.warning("没有找到选中的数据");const t={categoryStats:re.map(e=>({category:e.label,count:oe.filter(t=>t.category===e.value).length})),severityStats:ie.map(e=>({severity:e.label,count:oe.filter(t=>t.severity===e.value).length})),recentlyAdded:oe.sort((e,t)=>new Date(t.created_at).getTime()-new Date(e.created_at).getTime()).slice(0,5)};let l="# 知识库导出报告\n\n";l+=`导出时间: ${(new Date).toLocaleString()}\n\n`,l+=`总条目数: ${e.length}\n\n`,l+="## 统计概览\n\n### 分类分布\n",t.categoryStats.forEach(e=>{l+=`- ${e.category}: ${e.count} 条\n`}),l+="\n### 严重级别分布\n",t.severityStats.forEach(e=>{l+=`- ${e.severity}: ${e.count} 条\n`}),l+="\n## 知识条目\n\n",e.forEach((e,t)=>{var n,a;const s=(e=>{let t=0;e.content.length>500?t+=25:e.content.length>200?t+=15:t+=5,e.tags.length>=3?t+=20:e.tags.length>=2?t+=15:t+=5,e.title.length>10&&e.title.length<100?t+=20:t+=10;const l=Math.floor((Date.now()-new Date(e.updated_at).getTime())/864e5);return t+=l<30?20:l<90?15:5,e.category&&e.severity&&e.metric_types.length>0?t+=15:t+=5,Math.min(100,t)})(e);l+=`### ${t+1}. ${e.title}\n\n`,l+=`**分类**: ${(null==(n=re.find(t=>t.value===e.category))?void 0:n.label)||e.category} | `,l+=`**严重级别**: ${(null==(a=ie.find(t=>t.value===e.severity))?void 0:a.label)||e.severity} | `,l+=`**质量评分**: ${s}/100\n\n`,l+=`**创建者**: ${e.created_by} | **创建时间**: ${new Date(e.created_at).toLocaleString()}\n\n`,e.tags&&e.tags.length>0&&(l+=`**标签**: ${e.tags.join(", ")}\n\n`),e.metric_types&&e.metric_types.length>0&&(l+=`**相关指标**: ${e.metric_types.join(", ")}\n\n`),l+=e.content.replace(/\\n/g,"\n")+"\n\n",l+="---\n\n"});const n=new Blob([l],{type:"text/markdown;charset=utf-8"}),a=URL.createObjectURL(n),s=document.createElement("a");s.href=a,s.download=`知识库报告_${(new Date).toISOString().slice(0,10)}.md`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(a),V.success(`成功导出 ${e.length} 条知识库记录`)}catch(e){V.error("导出失败"),console.error("导出失败:",e)}},disabled:0===W.length,children:["导出选中项为Markdown ",W.length>0&&`(${W.length})`]}),t.jsx(j,{type:"primary",icon:t.jsx(g,{}),onClick:()=>{G(null),J.resetFields(),Y(!0)},children:"新建知识库条目"})]})]})]}),t.jsx(c,{children:t.jsx(b,{columns:pe,dataSource:(null==(U=null==ge?void 0:ge.data)?void 0:U.items)||[],loading:!1,rowKey:"id",scroll:{x:1200},rowSelection:{selectedRowKeys:W,onChange:e=>{X(e)},onSelectAll:(e,t,l)=>{var n,a;if(e){const e=((null==(n=null==ge?void 0:ge.data)?void 0:n.items)||[]).map(e=>e.id);X([...W,...e.filter(e=>!W.includes(e))])}else{const e=((null==(a=null==ge?void 0:ge.data)?void 0:a.items)||[]).map(e=>e.id);X(W.filter(t=>!e.includes(t)))}},getCheckboxProps:e=>({name:e.title})},pagination:{current:ae.page,pageSize:ae.page_size,total:(null==(H=null==ge?void 0:ge.data)?void 0:H.total)||0,showSizeChanger:!0,showQuickJumper:!0,showTotal:(e,t)=>`第 ${t[0]}-${t[1]} 条，共 ${e} 条`,onChange:(e,t)=>{se({...ae,page:e,page_size:t||10})}}})}),t.jsx(f,{title:Q?"编辑知识库条目":"新建知识库条目",open:N,onCancel:()=>{Y(!1),G(null),J.resetFields()},footer:null,width:800,destroyOnHidden:!0,styles:{body:{maxHeight:"70vh",overflowY:"auto"}},children:t.jsxs(a,{form:J,layout:"vertical",onFinish:async e=>{try{await new Promise(e=>setTimeout(e,500)),Q?(console.log("模拟更新知识库条目:",Q.id,e),V.success("更新成功")):(console.log("模拟创建知识库条目:",e),V.success("创建成功")),Y(!1),G(null),J.resetFields(),xe()}catch(t){V.error(Q?"更新失败":"创建失败"),console.error("操作失败:",t)}},initialValues:{severity:"medium",category:"troubleshooting"},children:[t.jsx(a.Item,{name:"title",label:"标题",rules:[{required:!0,message:"请输入标题"}],children:t.jsx(y,{placeholder:"请输入知识库条目标题"})}),t.jsx(a.Item,{name:"content",label:"内容",rules:[{required:!0,message:"请输入内容"}],children:t.jsx(Z,{rows:8,placeholder:"请输入详细内容，包括问题描述、解决方案、注意事项等"})}),t.jsxs(i,{gutter:16,children:[t.jsx(o,{span:12,children:t.jsx(a.Item,{name:"category",label:"分类",rules:[{required:!0,message:"请选择分类"}],children:t.jsx(p,{placeholder:"选择分类",children:re.map(e=>t.jsx(z,{value:e.value,children:e.label},e.value))})})}),t.jsx(o,{span:12,children:t.jsx(a.Item,{name:"severity",label:"严重级别",rules:[{required:!0,message:"请选择严重级别"}],children:t.jsx(p,{placeholder:"选择严重级别",children:ie.map(e=>t.jsx(z,{value:e.value,children:t.jsx(w,{color:e.color,text:e.label})},e.value))})})})]}),t.jsx(a.Item,{name:"tags",label:"标签",children:t.jsx(p,{mode:"tags",placeholder:"输入标签，按回车添加",tokenSeparators:[","," "]})}),t.jsx(a.Item,{name:"metric_types",label:"相关指标类型",children:t.jsx(p,{mode:"multiple",placeholder:"选择相关的指标类型",allowClear:!0,children:["cpu_usage","memory_usage","disk_usage","network_traffic","response_time","error_rate","throughput","availability"].map(e=>t.jsx(z,{value:e,children:e},e))})}),t.jsx(T,{}),t.jsx(a.Item,{style:{marginBottom:0},children:t.jsxs(m,{style:{width:"100%",justifyContent:"flex-end"},children:[t.jsx(j,{onClick:()=>{Y(!1),G(null),J.resetFields()},children:"取消"}),t.jsx(j,{type:"primary",htmlType:"submit",children:Q?"更新":"创建"})]})})]})}),t.jsx(f,{title:"知识库详情",open:le,onCancel:()=>{ne(!1),te(null)},footer:[t.jsx(j,{onClick:()=>{ne(!1),te(null)},children:"关闭"},"close"),t.jsx(j,{type:"primary",icon:t.jsx(S,{}),onClick:()=>{ee&&(ye(ee),ne(!1),te(null))},children:"编辑"},"edit")],width:800,destroyOnHidden:!0,styles:{body:{maxHeight:"70vh",overflowY:"auto"}},children:ee&&t.jsxs("div",{children:[t.jsxs("div",{style:{marginBottom:"24px"},children:[t.jsx(D,{level:4,style:{marginBottom:"16px"},children:ee.title}),t.jsxs(i,{gutter:[16,16],children:[t.jsxs(o,{span:12,children:[t.jsx(F,{strong:!0,children:"分类："}),t.jsx(C,{color:"blue",style:{marginLeft:"8px"},children:(null==(R=re.find(e=>e.value===ee.category))?void 0:R.label)||ee.category})]}),t.jsxs(o,{span:12,children:[t.jsx(F,{strong:!0,children:"严重级别："}),t.jsx(w,{color:(null==(q=ie.find(e=>e.value===ee.severity))?void 0:q.color)||"default",text:(null==(O=ie.find(e=>e.value===ee.severity))?void 0:O.label)||ee.severity,style:{marginLeft:"8px"}})]}),t.jsxs(o,{span:12,children:[t.jsx(F,{strong:!0,children:"创建者："}),t.jsx(F,{style:{marginLeft:"8px"},children:ee.created_by})]}),t.jsxs(o,{span:12,children:[t.jsx(F,{strong:!0,children:"创建时间："}),t.jsx(F,{style:{marginLeft:"8px"},children:new Date(ee.created_at).toLocaleString()})]})]}),ee.tags&&ee.tags.length>0&&t.jsxs("div",{style:{marginTop:"16px"},children:[t.jsx(F,{strong:!0,children:"标签："}),t.jsx("div",{style:{marginTop:"8px"},children:t.jsx(m,{wrap:!0,children:ee.tags.map(e=>t.jsx(C,{icon:t.jsx(k,{}),children:e},e))})})]}),ee.metric_types&&ee.metric_types.length>0&&t.jsxs("div",{style:{marginTop:"16px"},children:[t.jsx(F,{strong:!0,children:"相关指标类型："}),t.jsx("div",{style:{marginTop:"8px"},children:t.jsx(m,{wrap:!0,children:ee.metric_types.map(e=>t.jsx(C,{color:"green",children:e},e))})})]})]}),t.jsx(T,{}),t.jsxs("div",{children:[t.jsx(D,{level:5,style:{marginBottom:"16px"},children:"详细内容"}),t.jsx("div",{style:{background:"#f5f5f5",padding:"16px",borderRadius:"6px",whiteSpace:"pre-wrap",lineHeight:"1.6"},children:ee.content.replace(/\\n/g,"\n")})]})]})})]})};export{B as default};
